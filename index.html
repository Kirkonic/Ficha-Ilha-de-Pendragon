<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Ficha de RPG</title>
<style>
body{font-family:Arial;background:#1b1026;color:#f2e9ff;margin:0;padding:0}
header{background:#2a1740;padding:10px;text-align:center;font-size:22px;font-weight:bold}
nav{display:flex;flex-wrap:wrap;background:#3a1f5c}
nav button{flex:1 1 50%;padding:12px;background:#3a1f5c;border:none;color:#fff;cursor:pointer;font-size:16px}
nav button:hover{background:#4a2a73}
section{display:none;padding:12px}
section.active{display:block}
.card{background:#2f1b4a;padding:10px;margin-bottom:10px;border-radius:10px}
input,textarea{width:100%;background:#2a1740;color:#fff;border:1px solid #5a3a85;border-radius:6px;padding:8px;font-size:16px}
.attribute{display:grid;grid-template-columns:1fr 80px 90px;gap:6px;align-items:center}
.attribute button{padding:6px;font-size:14px}
.bar-container{background:#5a3a85;border-radius:10px;overflow:hidden;height:18px;margin-bottom:5px}
.bar{height:100%;width:100%}
.red{background:#c0392b}
.blue{background:#2980b9}
.item{border:1px solid #5a3a85;padding:6px;margin:6px 0;border-radius:6px}
.log{background:#2a1740;max-height:200px;overflow:auto;padding:6px;font-size:14px}
@media(max-width:600px){
header{font-size:18px}
.attribute{grid-template-columns:1fr 70px 80px}
nav button{flex:1 1 100%}
}
</style>
<script>
// Garantia: showTab existe antes do HTML usar
function showTab(id){
 document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
 const el=document.getElementById(id); if(el) el.classList.add('active');
}
</script>
</head>
<body>
<header>Ficha de Personagem</header>
<nav>
<button onclick="showTab('descricao')">Descrição</button>
<button onclick="showTab('atributos')">Atributos</button>
<button onclick="showTab('historia')">História</button>
<button onclick="showTab('combate')">Combate</button>
<button onclick="showTab('itens')">Itens</button>
<button onclick="showTab('habilidades')">Habilidades</button>
<button onclick="showTab('dados')">Dados</button>
<button onclick="showTab('historico')">Histórico</button>
</nav>

<section id="descricao" class="active">
<div class="card">
<label>Imagem da Ficha</label>
<input type="text" placeholder="URL da imagem ou gif">
</div>
<div class="card">
<label>Nome</label><input>
<label>Raça / Espécie</label><input>
<label>Classe / Profissão</label><input>
<label>Idade</label><input>
<label>Sexo</label><input>
<label>Altura</label><input>
<label>Afiliamento Moral</label><input>
</div>
<div class="card">
<button onclick="exportarJSON()">Exportar ficha (JSON)</button>
<input type="file" id="importJSON" accept="application/json" onchange="importarJSON(event)">
</div>
</section>

<section id="atributos"></section>

<section id="historia">
<textarea rows="10" placeholder="História do personagem"></textarea>
</section>

<section id="combate">
<div class="card">
<label>Vida (PV)</label>
<input type="number" id="pvAtual" value="100"> / <input type="number" id="pvMax" value="100">
<div class="bar-container"><div id="pvBar" class="bar red"></div></div>
<label>P.T</label>
<input type="number" id="ptAtual" value="5"> / <input type="number" id="ptMax" value="5">
<div class="bar-container"><div id="ptBar" class="bar blue"></div></div>
</div>
</section>

<section id="itens">
<div class="card">
<input id="itemNome" placeholder="Nome do item">
<textarea id="itemDesc" placeholder="Descrição"></textarea>
<input id="itemImg" placeholder="URL imagem/gif">
<button onclick="addItem('itensLista','itemNome','itemDesc','itemImg')">Adicionar Item</button>
</div>
<div id="itensLista"></div>
</section>

<section id="habilidades">
<div class="card">
<input id="habNome" placeholder="Nome da habilidade">
<textarea id="habDesc" placeholder="Descrição"></textarea>
<input id="habImg" placeholder="URL imagem/gif">
<button onclick="addItem('habLista','habNome','habDesc','habImg')">Adicionar Habilidade</button>
</div>
<div id="habLista"></div>
</section>

<section id="dados">
<div class="card">
<label>Quantidade</label><input id="qtd" type="number" value="1">
<label>Faces</label><input id="faces" type="number" value="20">
<label>Modificador</label><input id="mod" type="number" value="0">
<button onclick="rolarCustom()">Rolar</button>
<div id="resultado"></div>
</div>
</section>

<section id="historico">
<div class="log" id="log"></div>
</section>

<script>
const atributos=[
['Força','d100'],['Defesa','d100'],['Percepção','d20'],['Inteligência','d20'],['Furtividade','d20'],['Intimidação','d20'],['Carisma','d20'],['Agilidade','d20'],['Intuição','d20'],['Poder Mágico','d100'],['Vontade','d100'],['Precisão','d20']
];
const tabela=[
{p:-1,b:-2},{p:0,b:-1},{p:1,b:0},{p:3,b:1},{p:6,b:2},{p:10,b:3},{p:15,b:4},{p:21,b:5},{p:28,b:6}
];
const attDiv=document.getElementById('atributos');
let totalLimite=20;
atributos.forEach(a=>{
 let c=document.createElement('div');c.className='card attribute';
 c.innerHTML=`<b>${a[0]}</b><input type='number' min='-1' max='35' value='1'><button>Rolar</button><div></div>`;
 let input=c.children[1],btn=c.children[2],res=c.children[3];
 btn.onclick=()=>{
  let total=0;document.querySelectorAll('#atributos input').forEach(i=>total+=parseInt(i.value)||0);
  if(total>totalLimite){alert('Limite de 20 pontos em atributos');input.value=1;return;}
  let pts=parseInt(input.value)||0;let bonus=0;
  for(let t of tabela){if(pts>=t.p)bonus=t.b}
  let faces=a[1]=='d100'?100:20;let conv=a[1]=='d100'?bonus*5:bonus;
  let roll=Math.floor(Math.random()*faces)+1;
  let soma=roll+conv;
  res.textContent=`${roll} ${conv>=0?'+':''}${conv} = ${soma}`;
  log.innerHTML+=`<div>${a[0]}: ${res.textContent}</div>`;
 };
 attDiv.appendChild(c);
});

function rolarCustom(){
 let q=+qtd.value,f=+faces.value,m=+mod.value;let t=m,r=[];
 for(let i=0;i<q;i++){let d=Math.floor(Math.random()*f)+1;r.push(d);t+=d;}
 let txt=`${q}d${f} [${r.join(', ')}] ${m>=0?'+':''}${m} = ${t}`;
 resultado.textContent=txt;log.innerHTML+=`<div>${txt}</div>`;
}

function addItem(lista,n,d,i){
 let l=document.getElementById(lista);let div=document.createElement('div');div.className='item';
 div.innerHTML=`<b>${document.getElementById(n).value}</b><br>${document.getElementById(d).value}<br><img src='${document.getElementById(i).value}' width='80'><br><button onclick='this.parentElement.remove()'>Remover</button>`;
 l.appendChild(div);
}

function updateBars(){
 pvBar.style.width=(pvAtual.value/pvMax.value*100)+'%';
 ptBar.style.width=(ptAtual.value/ptMax.value*100)+'%';
}
setInterval(updateBars,200);

function exportarJSON(){
 const data={};
 data.inputs=[...document.querySelectorAll('input,textarea')].map(i=>({id:i.id,value:i.value}));
 data.itens=itensLista.innerHTML;
 data.habilidades=habLista.innerHTML;
 const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
 const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='ficha.json';a.click();
}

function importarJSON(e){
const file=e.target.files[0];
if(!file) return;
const reader=new FileReader();
reader.onload=()=>{
 try{
  const data=JSON.parse(reader.result);
  if(data.inputs){
   data.inputs.forEach(i=>{
    const el=document.getElementById(i.id);
    if(el) el.value=i.value;
   });
  }
  if(data.itens!==undefined) itensLista.innerHTML=data.itens;
  if(data.habilidades!==undefined) habLista.innerHTML=data.habilidades;
  updateBars();
  log.innerHTML+='<div>Ficha importada com sucesso.</div>';
 }catch(err){
  alert('Arquivo JSON inválido');
 }
};
reader.readAsText(file);
}

function salvarLocal(){
 const data={};
 data.inputs=[...document.querySelectorAll('input,textarea')].map(i=>({id:i.id,value:i.value}));
 data.itens=itensLista.innerHTML;
 data.habilidades=habLista.innerHTML;
 localStorage.setItem('fichaRPG',JSON.stringify(data));
}
function carregarLocal(){
 const raw=localStorage.getItem('fichaRPG');if(!raw)return;
 const d=JSON.parse(raw);
 d.inputs.forEach(i=>{const el=document.getElementById(i.id);if(el)el.value=i.value});
 itensLista.innerHTML=d.itens||'';
 habLista.innerHTML=d.habilidades||'';
}
setInterval(salvarLocal,2000);
window.addEventListener('load',carregarLocal);
</script>
</body>
</html>
